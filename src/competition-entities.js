const { Node, getUrlExtension } = require('./common-data');

const CompetitionType = {
    Football: 'FOOTBALL'
};

const ConfrontationStatus = {
    NotStarted: 'NOT_STARTED',
    InProgress: 'IN_PROGRESS',
    Finished: 'FINISHED',
    Cancelled: 'CANCELED'
};

/**
 * Defines the type of Competition allowed in our system.
 * It's used as an input to fetch a {@link Competition} from third party data sources
 * and persist it in our local database
 */
class CompetitionInput {

    /**     
     * @param {String} id autogenerated identifier
     * @param {String} type the type of a competition (can be an enum) eg: FOOTBALL. Have to be one of the {@link CompetitionType}
     * @param {String} code identification of a competition eg: WORLD_CUP
     * @param {Number} apiId the identifier from a third party API
     * @param {Number} season the season of the competition
     * @param {String} name the name of the competition
     */
    constructor(id, type, code, apiId, season) {
        this.id = id;
        this.type = type;
        this.code = code;
        this.apiId = apiId;
        this.season = season;
    }

    /**
     * @returns the resource identifier of a competition, used by clients to show the 
     * name of the competition in the UI
     */
    competitionName() {
        return `${this.type.toLocaleLowerCase()}_${this.code.toLocaleLowerCase}`;
    }
}

/**
 * A group of {@link Confrontation} organized by {@link Round}s
 * 
 * An example of Competition can be:
 * - World Cup 2022
 * - UFC 2022
 * - Big Brother 2018
 * - President Election 2016
 */
class Competition {

    /**     
     * @param {String} code the code to identify this competition
     * @param {String} id autogenerated identifier
     * @param {Date} startAt when it starts
     * @param {Date} endAt when it finishes 
     * @param {Int} currentRound which round is now
     * @param {Array<String>} rounds how many rounds it has until today
     * @param {Array<Confrontation>} confrontations all confrontations available for this competition     
     * @param {Array<Contender>} contenders all teams participating in the competition
     * @param {String} logo the image from the third party API used to download the file
     * @param {Number} season the season of the competition
     */
    constructor(code, startAt, endAt, currentRound, confrontations, contenders, rounds, season, logo, fileName) {
        this.code = code;
        this.startAt = startAt;
        this.endAt = endAt;
        this.currentRound = currentRound;
        this.confrontations = confrontations;
        this.rounds = rounds;
        this.season = season;
        this.logo = logo;
        this.contenders = contenders;
        this.fileName = fileName;
    }
}

/**
 * A event where two or more opponents will face each other.
 * It contains a contests group that holds all possible bets for this confrontation
 * 
 * An example of confrontation can be:
 * - A match between two teams in the World Cup
 * - A F1 race
 * - A fight between two athletes
 */
class Confrontation {

    /**     
     * @param {Number} apiId id from API that provided the data to create this confrontation
     * @param {Date} startAt when the confrontation should start
     * @param {Date} allowBetsUntil until when the bets are allowed    
     * @param {String} round the corresponding round for this confrontation
     * @param {String} group the group related to this 
     * @param {Number} expectedDuration how long it should take
     * @param {Node} contest what can be bet in this competition
     */
    constructor(apiId, startAt, allowBetsUntil, round, expectedDuration, status, contest) {
        this.apiId = apiId;
        this.startAt = startAt;
        this.allowBetsUntil = allowBetsUntil;
        this.round = round;
        this.expectedDuration = expectedDuration;
        this.status = status;
        this.contest = contest;
    }
}

/**
 * A contender is an entity that can be a candidate to be selected in a bets.
 * 
 * Examples of contenders can be 
 * - The winner of a duel, like a team or a fighter
 * - The score of a duel
 */
class Contender {

    /**     
     * @param {any} apiId id provided by the api used as datasource 
     */
    constructor(apiId, logo, fileName) {
        this.apiId = apiId;
        this.logo = logo;
        this.fileName = fileName;
    }
}

module.exports = {
    CompetitionType,
    ConfrontationStatus,
    CompetitionInput,
    Competition,
    Confrontation,
    Contender
}